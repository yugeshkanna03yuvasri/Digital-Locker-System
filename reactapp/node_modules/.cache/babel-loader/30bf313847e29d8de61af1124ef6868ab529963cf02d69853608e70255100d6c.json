{"ast":null,"code":"const API_BASE = \"\"; // same origin; webpack dev proxy can forward to backend\n\nfunction _getStored() {\n  try {\n    return JSON.parse(localStorage.getItem(\"auth\"));\n  } catch (e) {\n    return null;\n  }\n}\nfunction _store(obj) {\n  localStorage.setItem(\"auth\", JSON.stringify(obj));\n}\nfunction clearLocalAuth() {\n  localStorage.removeItem(\"auth\");\n}\nasync function login(email, password) {\n  const res = await fetch(`${API_BASE}/api/auth/login`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      email,\n      password\n    })\n  });\n  if (!res.ok) {\n    const err = await res.json().catch(() => ({}));\n    throw new Error(err.error || \"Login failed\");\n  }\n  const data = await res.json();\n  // backend returns accessToken and refreshToken\n  const auth = {\n    accessToken: data.accessToken,\n    refreshToken: data.refreshToken,\n    accessTokenExpiresAt: data.accessTokenExpiresAt || null\n  };\n  _store(auth);\n  // fetch user profile\n  const me = await meRequest(auth.accessToken).catch(() => null);\n  if (me) {\n    auth.user = me;\n    _store(auth);\n    return me;\n  }\n  return null;\n}\nasync function register(payload) {\n  const res = await fetch(`${API_BASE}/api/users/signup`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(payload)\n  });\n  if (!res.ok) {\n    const err = await res.json().catch(() => ({}));\n    throw new Error(err.error || \"Register failed\");\n  }\n  return await res.json();\n}\nasync function meRequest(token) {\n  const h = token ? {\n    Authorization: `Bearer ${token}`\n  } : {};\n  const res = await fetch(`${API_BASE}/api/auth/me`, {\n    headers: h\n  });\n  if (!res.ok) throw new Error(\"Not authenticated\");\n  return await res.json();\n}\nasync function refresh() {\n  const stored = _getStored();\n  if (!(stored !== null && stored !== void 0 && stored.refreshToken)) throw new Error(\"No refresh token\");\n  const res = await fetch(`${API_BASE}/api/auth/refresh`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      refreshToken: stored.refreshToken\n    })\n  });\n  if (!res.ok) {\n    clearLocalAuth();\n    throw new Error(\"Refresh failed\");\n  }\n  const data = await res.json();\n  const auth = {\n    accessToken: data.accessToken,\n    refreshToken: data.refreshToken,\n    accessTokenExpiresAt: data.accessTokenExpiresAt || null,\n    user: stored.user || null\n  };\n  _store(auth);\n  return auth;\n}\nasync function logout() {\n  const stored = _getStored();\n  try {\n    if (stored !== null && stored !== void 0 && stored.refreshToken) {\n      await fetch(`${API_BASE}/api/auth/logout`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          refreshToken: stored.refreshToken\n        })\n      });\n    }\n  } catch (e) {\n    // ignore\n  }\n  clearLocalAuth();\n}\nasync function fetchWithAuth(input, init = {}) {\n  let stored = _getStored();\n  let token = stored === null || stored === void 0 ? void 0 : stored.accessToken;\n  const headers = new Headers(init.headers || {});\n  if (token) headers.set(\"Authorization\", `Bearer ${token}`);\n  const res = await fetch(input, {\n    ...init,\n    headers\n  });\n  if (res.status !== 401) return res;\n  // try refresh once\n  try {\n    const newAuth = await refresh();\n    headers.set(\"Authorization\", `Bearer ${newAuth.accessToken}`);\n    return await fetch(input, {\n      ...init,\n      headers\n    });\n  } catch (e) {\n    clearLocalAuth();\n    throw e;\n  }\n}\nexport default {\n  login,\n  register,\n  meRequest,\n  refresh,\n  logout,\n  fetchWithAuth,\n  clearLocalAuth\n};","map":{"version":3,"names":["API_BASE","_getStored","JSON","parse","localStorage","getItem","e","_store","obj","setItem","stringify","clearLocalAuth","removeItem","login","email","password","res","fetch","method","headers","body","ok","err","json","catch","Error","error","data","auth","accessToken","refreshToken","accessTokenExpiresAt","me","meRequest","user","register","payload","token","h","Authorization","refresh","stored","logout","fetchWithAuth","input","init","Headers","set","status","newAuth"],"sources":["C:/Users/yuvasri/OneDrive/Desktop/Digital lock product/reactapp/src/utils/api.js"],"sourcesContent":["const API_BASE = \"\"; // same origin; webpack dev proxy can forward to backend\r\n\r\nfunction _getStored() {\r\n  try {\r\n    return JSON.parse(localStorage.getItem(\"auth\"));\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction _store(obj) {\r\n  localStorage.setItem(\"auth\", JSON.stringify(obj));\r\n}\r\n\r\nfunction clearLocalAuth() {\r\n  localStorage.removeItem(\"auth\");\r\n}\r\n\r\nasync function login(email, password) {\r\n  const res = await fetch(`${API_BASE}/api/auth/login`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ email, password }),\r\n  });\r\n  if (!res.ok) {\r\n    const err = await res.json().catch(() => ({}));\r\n    throw new Error(err.error || \"Login failed\");\r\n  }\r\n  const data = await res.json();\r\n  // backend returns accessToken and refreshToken\r\n  const auth = {\r\n    accessToken: data.accessToken,\r\n    refreshToken: data.refreshToken,\r\n    accessTokenExpiresAt: data.accessTokenExpiresAt || null,\r\n  };\r\n  _store(auth);\r\n  // fetch user profile\r\n  const me = await meRequest(auth.accessToken).catch(() => null);\r\n  if (me) {\r\n    auth.user = me;\r\n    _store(auth);\r\n    return me;\r\n  }\r\n  return null;\r\n}\r\n\r\nasync function register(payload) {\r\n  const res = await fetch(`${API_BASE}/api/users/signup`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(payload),\r\n  });\r\n  if (!res.ok) {\r\n    const err = await res.json().catch(() => ({}));\r\n    throw new Error(err.error || \"Register failed\");\r\n  }\r\n  return await res.json();\r\n}\r\n\r\nasync function meRequest(token) {\r\n  const h = token ? { Authorization: `Bearer ${token}` } : {};\r\n  const res = await fetch(`${API_BASE}/api/auth/me`, { headers: h });\r\n  if (!res.ok) throw new Error(\"Not authenticated\");\r\n  return await res.json();\r\n}\r\n\r\nasync function refresh() {\r\n  const stored = _getStored();\r\n  if (!stored?.refreshToken) throw new Error(\"No refresh token\");\r\n  const res = await fetch(`${API_BASE}/api/auth/refresh`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ refreshToken: stored.refreshToken }),\r\n  });\r\n  if (!res.ok) {\r\n    clearLocalAuth();\r\n    throw new Error(\"Refresh failed\");\r\n  }\r\n  const data = await res.json();\r\n  const auth = {\r\n    accessToken: data.accessToken,\r\n    refreshToken: data.refreshToken,\r\n    accessTokenExpiresAt: data.accessTokenExpiresAt || null,\r\n    user: stored.user || null,\r\n  };\r\n  _store(auth);\r\n  return auth;\r\n}\r\n\r\nasync function logout() {\r\n  const stored = _getStored();\r\n  try {\r\n    if (stored?.refreshToken) {\r\n      await fetch(`${API_BASE}/api/auth/logout`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ refreshToken: stored.refreshToken }),\r\n      });\r\n    }\r\n  } catch (e) {\r\n    // ignore\r\n  }\r\n  clearLocalAuth();\r\n}\r\n\r\nasync function fetchWithAuth(input, init = {}) {\r\n  let stored = _getStored();\r\n  let token = stored?.accessToken;\r\n  const headers = new Headers(init.headers || {});\r\n  if (token) headers.set(\"Authorization\", `Bearer ${token}`);\r\n  const res = await fetch(input, { ...init, headers });\r\n  if (res.status !== 401) return res;\r\n  // try refresh once\r\n  try {\r\n    const newAuth = await refresh();\r\n    headers.set(\"Authorization\", `Bearer ${newAuth.accessToken}`);\r\n    return await fetch(input, { ...init, headers });\r\n  } catch (e) {\r\n    clearLocalAuth();\r\n    throw e;\r\n  }\r\n}\r\n\r\nexport default {\r\n  login,\r\n  register,\r\n  meRequest,\r\n  refresh,\r\n  logout,\r\n  fetchWithAuth,\r\n  clearLocalAuth,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}